import { inject, injectable } from 'tsyringe';
import { typeorm } from '@seidor-cloud-produtos/lib-seidor-common';

import <%= props.nameCamelCaseUpperFirst %> from '../infra/http/typeorm/entities/<%= props.nameCamelCaseUpperFirst %>';
import I<%= props.nameCamelCaseUpperFirst %>RequestGetAllDTO from '../dtos/I<%= props.nameCamelCaseUpperFirst %>RequestGetAllDTO';
import I<%= props.nameCamelCaseUpperFirst %>RepositoryDTO from '../repositories/I<%= props.nameCamelCaseUpperFirst %>RepositoryDTO';

@injectable()
export default class <%= props.nameCamelCaseUpperFirst %>Service {
    constructor(
        @inject('<%= props.nameCamelCaseUpperFirst %>Repository')
        private <%= props.nameCamelCase %>Repository: I<%= props.nameCamelCaseUpperFirst %>RepositoryDTO,
    ) {}

    public async getAll(
        queryParams: I<%= props.nameCamelCaseUpperFirst %>RequestGetAllDTO,
        withPagination: boolean,
    ): Promise<
        | <%= props.nameCamelCaseUpperFirst %>[]
        | ({
              data: <%= props.nameCamelCaseUpperFirst %>[];
          } & {
              count: number;
              limit: number;
              page: number;
              totalPages: number;
          })
    > {
        const options = typeorm.formatParamsToTypeOrmOptionsWithPaginate(
            queryParams,
        );

        if (withPagination) {
            const array<%= props.nameCamelCaseUpperFirst %> = await this.<%= props.nameCamelCase %>Repository.getAllWithPagination(
                options,
            );

            return typeorm.formatPaginateDataToResponse(queryParams, array<%= props.nameCamelCaseUpperFirst %>);
        }

        return this.<%= props.nameCamelCase %>Repository.getAllWithoutPagination(options);
    }
}
